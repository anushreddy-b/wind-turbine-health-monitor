<div class="page">
  <div class="page-header">
    <div>
      <h2>Fleet overview</h2>
      <p>Filter turbines by region and farm to drill into operations.</p>
    </div>
    <div class="filters">
      <div class="filter">
        <label>Region</label>
        <select [(ngModel)]="selectedRegion" (change)="applyFilters()">
          <option value="">All regions</option>
          <option *ngFor="let region of regions" [value]="region">{{ region }}</option>
        </select>
      </div>
      <div class="filter">
        <label>Farm</label>
        <select [(ngModel)]="selectedFarm" (change)="applyFilters()">
          <option value="">All farms</option>
          <option *ngFor="let farm of farms" [value]="farm">{{ farm }}</option>
        </select>
      </div>
      <button class="clear-btn" type="button" (click)="clearFilters()">Clear</button>
    </div>
  </div>

  <div class="form-panel">
    <div class="form-header">
      <div>
        <h3>{{ formState.turbineId ? 'Edit turbine' : 'Add turbine' }}</h3>
        <p>Manage turbine metadata and capacity.</p>
      </div>
      <button class="ghost-btn" type="button" (click)="startCreate()">New</button>
    </div>
    <div class="form-grid">
      <label>
        Name
        <input type="text" [(ngModel)]="formState.name" placeholder="Turbine name">
      </label>
      <label>
        Farm
        <input type="text" [(ngModel)]="formState.farm" placeholder="Farm name">
      </label>
      <label>
        Region
        <input type="text" [(ngModel)]="formState.region" placeholder="Region">
      </label>
      <label>
        Capacity (MW)
        <input type="number" [(ngModel)]="formState.capacityMw" placeholder="2.5">
      </label>
    </div>
    <div class="form-actions">
      <button class="primary-btn" type="button" (click)="saveTurbine()">
        {{ formState.turbineId ? 'Update turbine' : 'Create turbine' }}
      </button>
      <span class="form-message" *ngIf="formMessage">{{ formMessage }}</span>
    </div>
  </div>

  <div *ngIf="filteredList.length === 0" class="empty-state">
    No turbines match the current filters.
  </div>

  <div class="grid" *ngIf="filteredList.length > 0">
    <div class="card" *ngFor="let t of filteredList">
      <div class="card-header">
        <div>
          <div class="title">{{ t.name || ('T-' + t.turbineId) }}</div>
          <div class="subtitle">{{ t.farm }} · {{ t.region }}</div>
        </div>
        <div class="card-actions">
          <span class="status-pill" [ngClass]="getHealthClass(t.health)">{{ t.health }}</span>
          <button class="icon-btn" type="button" (click)="startEdit(t)">Edit</button>
          <button class="icon-btn danger" type="button" (click)="deleteTurbine(t.turbineId)">Delete</button>
        </div>
      </div>
      <div class="metrics">
        <div>
          <span>Power</span>
          <strong>{{ t.powerOutput | number: '1.0-0' }} kW</strong>
        </div>
        <div>
          <span>Wind</span>
          <strong>{{ t.windSpeed | number: '1.0-1' }} m/s</strong>
        </div>
        <div>
          <span>Rotor</span>
          <strong>{{ t.rotorSpeed | number: '1.0-1' }} rpm</strong>
        </div>
      </div>
      <div class="meta">
        Capacity {{ t.capacityMw | number: '1.0-1' }} MW ·
        Last update {{ t.timestamp ? (t.timestamp | date: 'short') : 'n/a' }}
      </div>
    </div>
  </div>
</div>
